import { Names } from "packages/pdf/src/syntax/names";
import { PdfBuffer } from "../../buffer";
import { FilterName, IFilter } from "./filter";

export class ASCIIHexDecode implements IFilter {
  public readonly name: FilterName = Names.ASCIIHexDecode;

  public encode(data: Uint8Array): Uint8Array {
    let result = "";
    for (let i = 0; i < data.length; i++) {
      const byte = data[i];
      const hex = byte.toString(16).toUpperCase();
      result += hex.length === 1 ? `0${hex}` : hex;
    }
    result += ">";

    return PdfBuffer.stringToRaw(result);
  }

  public decode(data: Uint8Array): Uint8Array {
    const output: number[] = [];

    const decoder = new TextDecoder();
    const hexString = decoder.decode(data);
    for (let i = 0; i < hexString.length; i += 2) {
      const hexByte = hexString.substring(i, i + 2);
      const byte = parseInt(hexByte, 16);
      output.push(byte);
    }

    return new Uint8Array(output);
  }
}
