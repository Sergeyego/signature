import { PdfBuffer } from "./buffer";

export class PdfView {

  /**
   * Длинна массива данных.
   */
  public readonly length: number;

  public constructor(
    public buffer: PdfBuffer = new PdfBuffer(),
    public offset: number = 0,
    offsetEnd?: number,
  ) {
    const view = this.buffer.raw.subarray(this.offset, offsetEnd);
    this.length = view.length;

    if (!view.length && offsetEnd && this.offset !== offsetEnd) {
      this.length = offsetEnd - this.offset;
    }
  }

  /**
   * Получение массива данных ссылаясь на массив буфера.
   * @returns
   */
  public getRaw(): Uint8Array {
    return this.buffer.raw.subarray(this.offset, this.offset + this.length);
  }

  /**
   * Преобразование массива данных из символьного кода в строку.
   * @returns
   */
  public toString(): string {
    const buf = this.getRaw();

    let res = "";
    for (let i = 0; i < buf.length; i++) {
      res += String.fromCharCode(buf[i]);
    }

    return res;
  }
}
